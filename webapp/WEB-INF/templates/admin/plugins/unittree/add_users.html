<@pageContainer>
    <@pageColumn>
        <@pageHeader title='#i18n{unittree.manageUnits.labelListUsers} #i18n{unittree.manageUnits.labelToAddToUnit} <strong>${unit.label!}</strong>' responsiveHeader=true />
		<@row> 
			<@columns xs=12 xl=4>
				<@box title='#i18n{portal.users.manage_users.search_users.buttonSearch}'>
					<@searchAdminUsersForm urlAction="jsp/admin/plugins/unittree/AddUsers.jsp" displayInDepthOption=false />
				</@box>
			</@columns>
			<@columns xs=12 xl=8>
				<@tform method='post' action='jsp/admin/plugins/unittree/DoAddUsers.jsp'>
				<#assign additionnalAttribute = "&session=session&idUnit=" + unit.idUnit! + sort_search_attribute! />
				<@input type='hidden' name='idUnit' value='${unit.idUnit!}' />
				<@box>
					<@boxHeader title='#i18n{unittree.addUsers.labelListUsers}' titleAuto=false>
						<!-- Check all button -->
						<@button type='button' class='checkbox-toggle me-auto' buttonIcon='square' />
						<@button type='submit' name='addUsers' class='ms-auto' value='#i18n{unittree.addUsers.btnAdd}' title='#i18n{unittree.addUsers.btnAdd}' buttonIcon='plus' />
					</@boxHeader>
					<@boxBody>
						<@table class='mailbox-messages'>
							<#-- LIST NON-ASSIGNED USERS -->
							<@tr>
								<@th></@th>
								<#if adminAvatar>
								<@th></@th>
								</#if>
								<@th>
									#i18n{unittree.addUsers.labelFirstName}
									<@sort jsp_url="jsp/admin/plugins/unittree/AddUsers.jsp" attribute="firstName${additionnalAttribute!}" />
								</@th>
								<@th>
									#i18n{unittree.addUsers.labelLastName}
									<@sort jsp_url="jsp/admin/plugins/unittree/AddUsers.jsp" attribute="lastName${additionnalAttribute!}" />
								</@th>
								<@th>
									#i18n{unittree.addUsers.labelAccessCode}
									<@sort jsp_url="jsp/admin/plugins/unittree/AddUsers.jsp" attribute="accessCode${additionnalAttribute!}" />
								</@th>
							</@tr>
							<#if listUsers?? && listUsers?has_content>
							<#list listUsers as user>
							<@tr>
								<@td><@checkBox orientation='switch' name='idUsers' value='${user.userId!}' /></@td>
								<#if adminAvatar>
								<@td>
									<img class="direct-chat-img" src="servlet/plugins/adminavatar/avatar?id_user=${user.userId}" alt="Avatar" title="Avatar">
								</@td>
								</#if>
								<@td>${user.firstName!}</@td>
								<@td>${user.lastName!}</@td>
								<@td>${user.accessCode!}</@td>
							</@tr>
							</#list>
							</#if>
						</@table>
						<#if listUnitUserAttributes?? && listUnitUserAttributes?has_content>
						<@fieldSet legend='#i18n{unittree.addUsers.labelValueToAffectToUsers}'>
							<#list listUnitUserAttributes as unitUserAttribute>
								<#if unitUserAttribute.template?has_content>
									<#include unitUserAttribute.template />
								</#if>
							</#list>
						</@fieldSet>
						</#if>
					</@boxBody>
				</@box>
			</@tform>
			</@columns>
		</@row>
		<@showPagination />
    </@pageColumn>
</@pageContainer>
<!-- Page Script -->
<script>
document.addEventListener('DOMContentLoaded', function () {
	// Enable check and uncheck all functionality
	const toggleButton = document.querySelector('.checkbox-toggle');
	if (toggleButton) {
		let isChecked = false;
		toggleButton.addEventListener('click', function () {
			const checkboxes = document.querySelectorAll('.mailbox-messages input[type="checkbox"]');
			const icon = this.querySelector('.ti');
			
			if (isChecked) {
				// Uncheck all checkboxes
				checkboxes.forEach(cb => cb.checked = false);
				if (icon) {
					icon.classList.remove('ti-square-check');
					icon.classList.add('ti-square');
				}
			} else {
				// Check all checkboxes
				checkboxes.forEach(cb => cb.checked = true);
				if (icon) {
					icon.classList.remove('ti-square');
					icon.classList.add('ti-square-check');
				}
			}
			isChecked = !isChecked;
		});
	}
});
</script>
